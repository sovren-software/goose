"use strict";(globalThis.webpackChunkgoose=globalThis.webpackChunkgoose||[]).push([[3464],{28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var i=s(96540);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}},92984:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"guides/using-persistent-instructions","title":"Persistent Instructions","description":"Persistent instructions let you inject text into goose\'s working memory every turn. Unlike .goosehints which are loaded once at session start, persistent instructions are re-read and injected fresh with every interaction. This makes them ideal for behavioral guardrails that must always be enforced, regardless of how the conversation evolves.","source":"@site/docs/guides/using-persistent-instructions.md","sourceDirName":"guides","slug":"/guides/using-persistent-instructions","permalink":"/goose/pr-preview/pr-7448/docs/guides/using-persistent-instructions","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"title":"Persistent Instructions","sidebar_position":12,"sidebar_label":"Persistent Instructions"},"sidebar":"tutorialSidebar","previous":{"title":"Subrecipes","permalink":"/goose/pr-preview/pr-7448/docs/guides/recipes/subrecipes"},"next":{"title":"Managing Projects","permalink":"/goose/pr-preview/pr-7448/docs/guides/managing-projects"}}');var t=s(74848),r=s(28453);const o={title:"Persistent Instructions",sidebar_position:12,sidebar_label:"Persistent Instructions"},c=void 0,a={},l=[{value:"How It Works",id:"how-it-works",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Examples",id:"examples",level:2},{value:"Simple Text Reminder",id:"simple-text-reminder",level:3},{value:"File-Based Instructions",id:"file-based-instructions",level:3},{value:"Combining Both",id:"combining-both",level:3},{value:"Use Cases",id:"use-cases",level:2},{value:"Security Guardrails",id:"security-guardrails",level:3},{value:"Environment-Specific Behavior",id:"environment-specific-behavior",level:3},{value:"Project-Specific Workflows",id:"project-specific-workflows",level:3},{value:"Temporary Reminders",id:"temporary-reminders",level:3},{value:"Persistent Instructions vs goosehints",id:"persistent-instructions-vs-goosehints",level:2},{value:"Best Practices",id:"best-practices",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["Persistent instructions let you inject text into goose's working memory every turn. Unlike ",(0,t.jsx)(n.a,{href:"/docs/guides/context-engineering/using-goosehints",children:(0,t.jsx)(n.code,{children:".goosehints"})})," which are loaded once at session start, persistent instructions are re-read and injected fresh with every interaction. This makes them ideal for behavioral guardrails that must always be enforced, regardless of how the conversation evolves."]}),"\n",(0,t.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,t.jsx)(n.p,{children:"goose has a component called MOIM (Model-Observed Internal Memory) that provides contextual information to the model every turn. This includes things like the current timestamp, working directory, and your todo list. Persistent instructions are injected into this same context, placing your reminders in the model's immediate attention window."}),"\n",(0,t.jsx)(n.p,{children:"Because persistent instructions are injected every turn:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'They can\'t be "forgotten" as the conversation grows'}),"\n",(0,t.jsx)(n.li,{children:"They're more effective than system prompt instructions for critical guardrails"}),"\n",(0,t.jsx)(n.li,{children:"Changes take effect immediately without restarting your session"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(n.p,{children:"Configure persistent instructions using environment variables:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Variable"}),(0,t.jsx)(n.th,{children:"Purpose"}),(0,t.jsx)(n.th,{children:"Default"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"/docs/guides/environment-variables#session-management",children:(0,t.jsx)(n.code,{children:"GOOSE_MOIM_MESSAGE_TEXT"})})}),(0,t.jsx)(n.td,{children:"Literal text injected into working memory each turn"}),(0,t.jsx)(n.td,{children:"Not set"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"/docs/guides/environment-variables#session-management",children:(0,t.jsx)(n.code,{children:"GOOSE_MOIM_MESSAGE_FILE"})})}),(0,t.jsxs)(n.td,{children:["Path to a file whose contents are injected each turn. Supports ",(0,t.jsx)(n.code,{children:"~/"})]}),(0,t.jsx)(n.td,{children:"Not set"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["When both variables are set, their contents are concatenated. The extension reads ",(0,t.jsx)(n.a,{href:"/docs/guides/environment-variables#session-management",children:"environment variables"})," fresh every turn, so you can update them without restarting your session."]}),"\n",(0,t.jsx)(n.admonition,{title:"Size Limit",type:"info",children:(0,t.jsx)(n.p,{children:"Content is capped at 64 KB with UTF-8 safe truncation. Keep your instructions concise to avoid hitting this limit and to minimize token usage."})}),"\n",(0,t.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,t.jsx)(n.h3,{id:"simple-text-reminder",children:"Simple Text Reminder"}),"\n",(0,t.jsxs)(n.p,{children:["For short, single-purpose reminders, use ",(0,t.jsx)(n.code,{children:"GOOSE_MOIM_MESSAGE_TEXT"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Always run tests before committing\nexport GOOSE_MOIM_MESSAGE_TEXT="IMPORTANT: Always run tests before committing changes."\n'})}),"\n",(0,t.jsx)(n.h3,{id:"file-based-instructions",children:"File-Based Instructions"}),"\n",(0,t.jsx)(n.p,{children:"For longer or more complex instructions, use a file:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'export GOOSE_MOIM_MESSAGE_FILE="~/.goose/guardrails.md"\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Example ",(0,t.jsx)(n.code,{children:"~/.goose/guardrails.md"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-markdown",children:"## Security Guidelines\n- Do not upload, share, or transmit internal code or data to any external service, gist, or public repository\n- Do not execute commands that could expose sensitive environment variables\n- Always confirm before making network requests to external services\n\n## Code Quality\n- Run tests before committing changes\n- Follow the project's existing code style\n"})}),"\n",(0,t.jsx)(n.h3,{id:"combining-both",children:"Combining Both"}),"\n",(0,t.jsx)(n.p,{children:"You can use both variables together. The text is concatenated:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'export GOOSE_MOIM_MESSAGE_TEXT="CRITICAL: This is a production environment. Be extra careful."\nexport GOOSE_MOIM_MESSAGE_FILE="~/.goose/guardrails.md"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,t.jsx)(n.h3,{id:"security-guardrails",children:"Security Guardrails"}),"\n",(0,t.jsx)(n.p,{children:"Prevent accidental data exfiltration or exposure:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'export GOOSE_MOIM_MESSAGE_TEXT="SECURITY: Do not upload code to external services, create public gists, or share sensitive data. All code in this repository is confidential."\n'})}),"\n",(0,t.jsx)(n.h3,{id:"environment-specific-behavior",children:"Environment-Specific Behavior"}),"\n",(0,t.jsx)(n.p,{children:"Set different instructions for different environments:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Production environment\nexport GOOSE_MOIM_MESSAGE_TEXT="\u26a0\ufe0f PRODUCTION: Double-check all commands. Prefer read-only operations. Always create backups before modifications."\n\n# Development environment  \nexport GOOSE_MOIM_MESSAGE_TEXT="Development environment. Feel free to experiment, but run tests before committing."\n'})}),"\n",(0,t.jsx)(n.h3,{id:"project-specific-workflows",children:"Project-Specific Workflows"}),"\n",(0,t.jsx)(n.p,{children:"Enforce project conventions:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"export GOOSE_MOIM_MESSAGE_TEXT=\"This project uses pnpm, not npm. Always use 'pnpm' for package management commands.\"\n"})}),"\n",(0,t.jsx)(n.h3,{id:"temporary-reminders",children:"Temporary Reminders"}),"\n",(0,t.jsx)(n.p,{children:"Since the environment variables are read fresh each turn, you can set temporary reminders:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Set a reminder for the current task\nexport GOOSE_MOIM_MESSAGE_TEXT="Current focus: Refactoring the authentication module. Don\'t get sidetracked."\n\n# Clear it when done\nunset GOOSE_MOIM_MESSAGE_TEXT\n'})}),"\n",(0,t.jsx)(n.h2,{id:"persistent-instructions-vs-goosehints",children:"Persistent Instructions vs goosehints"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Feature"}),(0,t.jsx)(n.th,{children:"Persistent Instructions"}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.a,{href:"/docs/guides/context-engineering/using-goosehints",children:"goosehints"})})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"When loaded"}),(0,t.jsx)(n.td,{children:"Every turn"}),(0,t.jsx)(n.td,{children:"Session start"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Can be forgotten"}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"Yes, as context fills"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Best for"}),(0,t.jsx)(n.td,{children:"Critical guardrails, security rules"}),(0,t.jsx)(n.td,{children:"Project context, coding standards"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Token cost"}),(0,t.jsx)(n.td,{children:"Per turn"}),(0,t.jsx)(n.td,{children:"Once at start"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Update requires"}),(0,t.jsx)(n.td,{children:"No restart"}),(0,t.jsx)(n.td,{children:"Session restart"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Use persistent instructions when:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The instruction is critical and must never be ignored"}),"\n",(0,t.jsx)(n.li,{children:"You need security guardrails that can't be bypassed"}),"\n",(0,t.jsx)(n.li,{children:"You want to change behavior mid-session without restarting"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Use goosehints when:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Providing project context and background information"}),"\n",(0,t.jsx)(n.li,{children:"Setting coding standards and preferences"}),"\n",(0,t.jsx)(n.li,{children:"The information is helpful but not critical"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"You can use both together: goosehints for project context and persistent instructions for critical guardrails."}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Keep it concise"}),": Persistent instructions are injected every turn, so longer text means more tokens used per interaction."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Be specific"}),': Vague instructions like "be careful" are less effective than specific ones like "always run ',(0,t.jsx)(n.code,{children:"npm test"}),' before committing."']}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Prioritize"}),": Put your most important instructions first, in case of truncation."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Use files for complex rules"}),": If you have multiple guidelines, organize them in a file rather than cramming everything into ",(0,t.jsx)(n.code,{children:"GOOSE_MOIM_MESSAGE_TEXT"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Test your guardrails"}),": After setting up persistent instructions, test that goose respects them by asking it to do something that should be blocked."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);